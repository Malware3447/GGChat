<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GGChat — Ваши чаты</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #007AFF;
            --primary-hover: #005BBF;
            --background-light: #F9FAFB;
            --text-dark: #1E293B;
            --shadow-light: 0 10px 30px rgba(0, 0, 0, 0.08);
            --border-radius-large: 16px;
            --transition-speed: 0.25s;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--background-light); color: var(--text-dark); line-height: 1.6; }
        a { text-decoration: none; color: var(--primary-color); }

        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; }
        .logo { font-size: 24px; font-weight: 800; color: var(--primary-color); }
        .create-btn { padding: 10px 16px; background: var(--primary-color); color: #fff; border-radius: 10px; font-weight: 600; transition: background-color var(--transition-speed), transform var(--transition-speed); border: none; cursor: pointer; }
        .create-btn:hover { background: var(--primary-hover); transform: translateY(-1px); }

        .page { padding: 10px 5% 40px; }
        .page-head { display: flex; justify-content: space-between; align-items: center; margin: 10px 0 20px; }
        .page-title { font-size: 28px; font-weight: 800; }

        .empty-state { background: #fff; border-radius: var(--border-radius-large); box-shadow: var(--shadow-light); padding: 40px; display: flex; align-items: center; justify-content: space-between; gap: 20px; }
        .empty-text { max-width: 560px; }
        .empty-text h2 { font-size: 24px; font-weight: 700; margin-bottom: 8px; }
        .empty-text p { color: #64748B; }
        .empty-illustration { width: 220px; height: 140px; background: radial-gradient(120px 80px at 60% 40%, #CFE6FF, #ffffff); border-radius: 16px; position: relative; box-shadow: var(--shadow-light); }
        .bubble { position: absolute; background: #fff; border: 1px solid #E2E8F0; border-radius: 12px; box-shadow: var(--shadow-light); }
        .bubble.one { width: 120px; height: 40px; left: 18px; top: 26px; }
        .bubble.two { width: 90px; height: 36px; right: 18px; bottom: 24px; }
        .bubble .dot { width: 6px; height: 6px; background: #94A3B8; border-radius: 50%; position: absolute; top: 50%; transform: translateY(-50%); }
        .bubble .dot:nth-child(1) { left: 14px; }
        .bubble .dot:nth-child(2) { left: 28px; }
        .bubble .dot:nth-child(3) { left: 42px; }

        .list { margin-top: 24px; display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 20px; }
        .chat-card { background: #fff; border-radius: 14px; box-shadow: var(--shadow-light); padding: 18px; transition: transform var(--transition-speed), box-shadow var(--transition-speed), border-color var(--transition-speed); border: 1px solid #E2E8F0; cursor: pointer; display: flex; align-items: center; gap: 14px; }
        .chat-card:hover { transform: translateY(-2px); box-shadow: 0 12px 28px rgba(0,0,0,0.08); border-color: #D1D5DB; }
        .avatar { width: 44px; height: 44px; border-radius: 12px; background: linear-gradient(135deg, #E0F2FF, #F3F8FF); color: var(--primary-color); font-weight: 800; display: grid; place-items: center; border: 1px solid #E2E8F0; }
        .meta { flex: 1; min-width: 0; }
        .name { font-weight: 700; font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .subtitle { color: #64748B; font-size: 13px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Modal */
        .modal-backdrop { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.35); display: none; align-items: center; justify-content: center; z-index: 40; }
        .modal { width: 100%; max-width: 420px; background: #fff; border-radius: 16px; box-shadow: var(--shadow-light); padding: 22px; transform: translateY(10px); opacity: 0; transition: opacity var(--transition-speed), transform var(--transition-speed); }
        .modal.open { transform: translateY(0); opacity: 1; }
        .modal-title { font-weight: 700; font-size: 18px; margin-bottom: 14px; }
        .input-group { margin-bottom: 16px; position: relative; }
        .input-group label { position: absolute; top: 14px; left: 14px; color: #94A3B8; transition: 0.2s ease-out; pointer-events: none; }
        .input-group input:focus ~ label, .input-group input:not(:placeholder-shown) ~ label { top: -10px; left: 10px; font-size: 12px; background-color: white; padding: 0 5px; color: var(--primary-color); }
        .input-group input { width: 100%; padding: 14px; border: 1px solid #E2E8F0; border-radius: 10px; font-size: 16px; transition: border-color 0.3s; }
        .input-group input:focus { outline: none; border-color: var(--primary-color); }
        .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 8px; }
        .btn { padding: 10px 14px; border-radius: 10px; font-weight: 600; border: none; cursor: pointer; }
        .btn.secondary { background: #F1F5F9; color: #0F172A; }
        .btn.primary { background: var(--primary-color); color: #fff; }
        .btn.primary:hover { background: var(--primary-hover); }

        @media (max-width: 1100px) {
            .list { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        }
        @media (max-width: 720px) {
            .header { padding: 16px 18px; }
            .page { padding: 10px 18px 32px; }
            .list { grid-template-columns: 1fr; }
            .empty-state { flex-direction: column; align-items: flex-start; }
            .empty-illustration { width: 100%; height: 120px; }
        }
    </style>
</head>
<body>

<header class="header">
    <div class="logo">GGChat</div>
    <button id="open-create" class="create-btn">Создать чат</button>
    </header>

<main class="page">
    <div class="page-head">
        <div class="page-title">Ваши чаты</div>
    </div>

    <section id="empty" class="empty-state" style="display: none;">
        <div class="empty-text">
            <h2>Пока у вас нет чатов</h2>
            <p>Нажмите «Создать чат», чтобы начать новый разговор. Вы сможете добавить собеседников позже.</p>
        </div>
        <div class="empty-illustration">
            <div class="bubble one">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
            <div class="bubble two">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
            </div>
        </div>
    </section>

    <section id="list" class="list" style="display: none;"></section>
</main>

<!-- Modal create chat -->
<div id="modal-backdrop" class="modal-backdrop">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="create-title">
        <div class="modal-title" id="create-title">Новый чат</div>
        <form id="create-form">
            <div class="input-group">
                <input id="chat-name" type="text" placeholder=" " autocomplete="off" required>
                <label for="chat-name">Название чата</label>
            </div>
            <div class="modal-actions">
                <button type="button" id="cancel-create" class="btn secondary">Отмена</button>
                <button type="submit" class="btn primary">Создать</button>
            </div>
        </form>
    </div>
    </div>
    <script>
        // Элементы DOM
        const openCreateBtn = document.getElementById('open-create');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const cancelCreateBtn = document.getElementById('cancel-create');
        const createForm = document.getElementById('create-form');
        const chatNameInput = document.getElementById('chat-name');
        const emptyState = document.getElementById('empty');
        const listSection = document.getElementById('list');

        // Открытие модального окна создания чата
        openCreateBtn.addEventListener('click', () => {
            modalBackdrop.style.display = 'flex';
            setTimeout(() => {
                modalBackdrop.classList.add('open');
            }, 10);
            chatNameInput.focus();
        });

        // Закрытие модального окна создания чата
        function closeCreateModal() {
            modalBackdrop.classList.remove('open');
            setTimeout(() => {
                modalBackdrop.style.display = 'none';
            }, 250);
            createForm.reset();
        }

        // Закрытие модального окна по кнопке отмены
        cancelCreateBtn.addEventListener('click', closeCreateModal);

        // Закрытие модального окна по клику на backdrop
        modalBackdrop.addEventListener('click', (e) => {
            if (e.target === modalBackdrop) {
                closeCreateModal();
            }
        });

        // Создание нового чата
        createForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const chatName = chatNameInput.value.trim();
            if (!chatName) return;
            
            try {
                // Отправка POST запроса для создания чата
                const response = await fetch('http://localhost:8080/api/v1/chats/new_chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ chat_name: chatName })
                });
                
                if (response.ok) {
                    // Закрываем модальное окно
                    closeCreateModal();
                    
                    // Обновляем список чатов
                    await loadChats();
                } else {
                    console.error('Ошибка при создании чата:', response.status);
                }
            } catch (error) {
                console.error('Ошибка при создании чата:', error);
            }
        });

        // Загрузка списка чатов
        async function loadChats() {
            try {
                const response = await fetch('http://localhost:8080/api/v1/chats/all_chats');
                
                if (response.ok) {
                    const chats = await response.json();
                    displayChats(chats);
                } else {
                    console.error('Ошибка при загрузке чатов:', response.status);
                    displayChats([]); // Отображаем пустой список в случае ошибки
                }
            } catch (error) {
                console.error('Ошибка при загрузке чатов:', error);
                displayChats([]); // Отображаем пустой список в случае ошибки
            }
        }

        // Отображение списка чатов
        function displayChats(chats) {
            if (chats.length === 0) {
                emptyState.style.display = 'flex';
                listSection.style.display = 'none';
                return;
            }
            
            emptyState.style.display = 'none';
            listSection.style.display = 'grid';
            
            // Очищаем список
            listSection.innerHTML = '';
            
            // Добавляем чаты в список
            chats.forEach(chat => {
                const chatCard = document.createElement('div');
                chatCard.className = 'chat-card';
                chatCard.innerHTML = `
                    <div class="avatar">${chat.name.charAt(0).toUpperCase()}</div>
                    <div class="meta">
                        <div class="name">${chat.name}</div>
                        <div class="subtitle">ID: ${chat.uuid}</div>
                    </div>
                `;
                
                // Обработчик клика на чат
                chatCard.addEventListener('click', () => {
                    // Переход на страницу чата
                    window.location.href = `../chat/index.html?uuid=${chat.uuid}`;
                });
                
                listSection.appendChild(chatCard);
            });
        }

        // Загрузка списка чатов при загрузке страницы
        document.addEventListener('DOMContentLoaded', loadChats);
    </script>

</body>
</html>

